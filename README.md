# ⚒️ IronForge 淬火工坊

> **IronForge（淬火工坊）** 是一款专为 **Xiaomi Vela 智能手表** 设计的趣味运动辅助应用。它利用手表内置的三轴加速度传感器，精准捕捉手腕的往复运动，实时记录你的每一次"锻造"过程，并提供详尽的多维数据分析、综合评级系统和隐藏成就挑战。

**作者**：弦 | **抖音**：LOVE54760 | **B站**：北极弦

---

## 📋 目录

- [功能概览](#-功能概览)
- [技术栈与平台要求](#-技术栈与平台要求)
- [项目架构](#-项目架构)
- [页面详解](#-页面详解)
  - [首页 (index)](#1-首页-index)
  - [锻造页 (forge)](#2-锻造页-forge)
  - [报告页 (report)](#3-报告页-report)
  - [历史记录页 (history)](#4-历史记录页-history)
  - [统计页 (stats)](#5-统计页-stats)
  - [设置页 (settings)](#6-设置页-settings)
  - [灵敏度设置页 (sensitivity)](#7-灵敏度设置页-sensitivity)
  - [成就殿堂页 (achievements)](#8-成就殿堂页-achievements)
- [核心算法：HammerDetector](#-核心算法hammerdetector)
- [评级系统](#-评级系统)
- [成就系统](#-成就系统)
- [数据持久化](#-数据持久化)
- [设计系统](#-设计系统)
- [快速开始](#-快速开始)
- [使用指南](#-使用指南)
- [许可证与作者](#-许可证与作者)

---

## 🎯 功能概览

| 功能模块 | 说明 |
| :--- | :--- |
| **精准锻造计数** | 基于加速度传感器的均值穿越检测算法，精准识别有效往复运动，过滤误触和微小抖动 |
| **实时数据面板** | 实时显示锻造次数、SPM（每分钟速度）、累计时长 |
| **后台持续计数** | 息屏状态下传感器和计时器持续运行，不中断锻造过程 |
| **震动反馈** | 每次有效锻造触发震感反馈，支持关/弱/中/强四级调节 |
| **多维评级系统** | 从时长、极速、稳定性、总量四个维度综合评级（SSS ~ D） |
| **周报/月报统计** | 自动汇总本周/本月核心指标，含每日分布柱状图和趣味评语 |
| **15 项隐藏成就** | 横跨 5 个稀有度等级的成就体系，包含时间彩蛋和极限挑战 |
| **个性化设置** | 佩戴方向、震动强度、检测灵敏度（高级用户可自定义阈值参数） |
| **数据管理** | 历史记录浏览、单条删除、一键清空，最多保留 50 条记录 |

---

## 🔧 技术栈与平台要求

### 开发框架

| 项目 | 详情 |
| :--- | :--- |
| **运行平台** | Xiaomi Vela 智能手表 (watch) |
| **开发框架** | AIoT Toolkit (`aiot-toolkit ^2.0.5`) |
| **JSC 引擎** | `@aiot-toolkit/jsc ^1.0.3` |
| **组件模式** | `.ux` 单文件组件（Template + Script + Style） |
| **设计宽度** | `device-width`（适配 212×520 圆角矩形屏幕） |
| **最低平台版本** | `minPlatformVersion: 1000` |
| **Node.js 要求** | `>= 8.10` |

### 支持设备

以下为理论支持的 Xiaomi Vela 设备列表（架构均为 ARM，平台版本 `vela-pre-4.0`）：

| 设备标识 | 设备型号 | 架构 | 平台版本 |
| :--- | :--- | :--- | :--- |
| `redmi_watch` | Redmi Watch | arm | vela-pre-4.0 |
| `xiaomi_band` | Xiaomi Band | arm | vela-pre-4.0 |
| `xiaomi_band_10` | Xiaomi Band 10 | arm | vela-pre-4.0 |
| `xiaomi_band_pro` | Xiaomi Band Pro | arm | vela-pre-4.0 |
| `xiaomi_s4` | Xiaomi Watch S4 | arm | vela-pre-4.0 |
| `xiaomi_s4_41` | Xiaomi Watch S4 (41mm) | arm | vela-pre-4.0 |

### 使用的系统 API

| API | 用途 |
| :--- | :--- |
| `system.sensor` | 订阅三轴加速度传感器数据（`game` 模式，约 50Hz） |
| `system.vibrator` | 锻造时触发震动反馈 |
| `system.storage` | 本地持久化存储（历史记录、设置、成就状态） |
| `system.router` | 页面间路由跳转 |
| `system.audio` | 音频（预留接口） |

---

## 📂 项目架构

```
IronForge/
├── package.json                # 项目配置（name: IronForge, version: 1.0.0）
├── README.md                   # 项目文档（本文件）
├── build/                      # 构建产物目录
├── dist/                       # 发布产物目录
├── sign/                       # 签名文件目录
├── node_modules/               # 依赖模块
├── src/
│   ├── manifest.json           # 应用清单（包名、权限、路由、特性声明）
│   ├── app.ux                  # 应用入口（全局样式定义、生命周期）
│   ├── config-watch.json       # 手表配置文件
│   ├── common/
│   │   ├── utils.js            # 核心工具模块（705 行）
│   │   │                        ├── HammerDetector   - 往复运动检测器
│   │   │                        ├── SPMCalculator    - SPM 计算器
│   │   │                        ├── 评级系统          - 4 维度 + 综合评级
│   │   │                        ├── 历史记录管理       - CRUD + 序列化
│   │   │                        ├── 设置管理          - 加载/保存/默认值
│   │   │                        ├── 成就系统          - 15 项成就定义 + 检测
│   │   │                        └── 统计函数          - 周报/月报聚合
│   │   └── logo.png            # 应用图标
│   ├── i18n/                   # 国际化资源目录
│   └── pages/
│       ├── index/index.ux      # 首页 - 应用入口主界面
│       ├── forge/forge.ux      # 锻造页 - 核心运动检测界面
│       ├── report/report.ux    # 报告页 - 本次锻造结果展示
│       ├── history/history.ux  # 历史记录页 - 数据列表管理
│       ├── stats/stats.ux      # 统计页 - 周报/月报数据可视化
│       ├── settings/settings.ux        # 设置页 - 常规配置
│       ├── sensitivity/sensitivity.ux  # 灵敏度页 - 高级检测参数调节
│       └── achievements/achievements.ux # 成就殿堂页 - 成就展示与进度
```

### 路由配置 (manifest.json)

| 路由路径 | 组件名 | 说明 |
| :--- | :--- | :--- |
| `pages/index` | index | **入口页面** |
| `pages/forge` | forge | 锻造核心页面 |
| `pages/report` | report | 锻造结束后的报告页面 |
| `pages/history` | history | 历史记录列表 |
| `pages/stats` | stats | 周报/月报统计 |
| `pages/settings` | settings | 用户设置 |
| `pages/sensitivity` | sensitivity | 灵敏度高级设置 |
| `pages/achievements` | achievements | 成就殿堂 |

---

## 📄 页面详解

### 1. 首页 (index)

**文件**: `src/pages/index/index.ux` (200 行)

首页是应用的启动界面，采用居中布局的极简设计。

**UI 元素**：
- **标题区域**：双色标题"铁"（白色）+"锻"（橙红色 `#FF4500`），下方有冷翠色 (`#00E5FF`) 装饰线，副标题"数字锻造模拟器"
- **铁砧图标**：纯 CSS 构建的像素化铁砧图标（由 anvil-top、anvil-body、anvil-base 三部分组成）
- **操作按钮**：
  - 🔴 **"开始锻造"** — 橙红色主按钮 (180×56px)，跳转至锻造页
  - ⚫ **"记录"** — 跳转至历史记录页
  - ⚫ **"成就"** — 跳转至成就殿堂
  - ⚫ **"设置"** — 跳转至设置页

**路由方式**：均使用 `router.push()` 进行页面跳转。

---

### 2. 锻造页 (forge)

**文件**: `src/pages/forge/forge.ux` (414 行)

这是应用的**核心功能页面**，负责接收传感器数据、检测有效锻造、计算实时数据并管理会话生命周期。

**UI 布局**：
- **顶部标题**："锻 造"
- **主计数区**：超大字号显示当前锻造次数
- **数据面板**：实时显示 SPM（速度）和时长（MM:SS 格式）
- **底部控制**："结束"按钮（橙红色圆角按钮）

**生命周期管理**：

| 事件 | 行为 |
| :--- | :--- |
| `onShow` | 首次进入：加载设置 → 初始化 `HammerDetector` → 自动开始锻造 |
| `onHide` | 息屏/后台：**不停止**传感器和计时器，保持后台计数 |
| `onDestroy` | 页面销毁：清理所有资源（传感器、定时器） |

**核心流程**：

```
onShow → loadSettings → startForge()
  ├── 初始化 HammerDetector（使用用户灵敏度设置）
  ├── 初始化 SPMCalculator（60秒滑动窗口）
  ├── subscribeSensor（game 模式，约50Hz采样率）
  │   └── 每帧数据 → detector.detect(x, y, z, timestamp)
  │       ├── 检测到冲程 → strokes++ → spmCalc.record() → 震动反馈
  │       └── 记录 SPM 历史（每5秒采样）
  ├── startTimer（每秒更新显示：时长、SPM值）
  └── 追踪 maxSPM、earlySPM（前30秒用于成就判定）
```

**暂停/恢复机制**：
- 支持 `pauseForge()` / `resumeForge()` 切换
- 暂停时停止传感器和计时器，恢复时重新启动
- 暂停次数 `_pauseCount` 被记录用于"寸止挑战"成就判定

**结束流程** (`stopForge()`):
1. 计算最终时长（累加所有活跃区间）
2. 计算 SPM 标准差百分比（节奏稳定性指标）
3. 生成四维评级 + 综合评级
4. 构建会话数据对象（`session`）
5. 保存到历史记录 (`saveSession`)
6. 加载历史 → 加载成就 → 检查新成就解锁
7. 使用 `router.replace()` 跳转到报告页（携带 `sessionData` 参数）

**会话数据结构**：

```javascript
{
  timestamp: Date.now(),          // 时间戳
  strokes: 123,                   // 总锻造次数
  duration: 456,                  // 总时长（秒）
  avgSPM: 78,                     // 平均 SPM
  maxSPM: 150,                    // 峰值 SPM
  earlySPM: 120,                  // 前30秒 SPM
  pauseCount: 2,                  // 暂停次数
  sdPercent: 15.3,                // SPM 标准差百分比
  ratings: {                      // 各维度评级
    overall: { tier: 'A', desc: '精良工艺', ... },
    duration: { tier: 'B', desc: '初燃之焰', ... },
    peak: { tier: 'A', desc: '快速节奏', ... },
    stability: { tier: 'S', desc: '节奏大师', ... },
    count: { tier: 'C', desc: '初步积累', ... }
  }
}
```

---

### 3. 报告页 (report)

**文件**: `src/pages/report/report.ux` (527 行)

锻造结束后的**结果展示页面**，展示本次锻造的完整数据和评级。

**UI 布局**：
- **成就解锁弹窗**（`unlock-overlay`）：新成就解锁时显示的全屏弹窗，包含成就名称、描述和确认按钮，支持多个成就依次弹出
- **综合评级卡片**：超大字号显示总评级（如"SSS"），带有对应颜色和描述
- **核心数据区**：总次数、时长、平均速度、峰值速度
- **详细评级**：展示四个维度的独立评级卡片，每张卡片含维度名称、描述和等级
- **操作按钮**："再来一次"（跳转锻造页）和"首页"（返回首页）

**时间成就检测**：
- 报告页加载后启动两个定时器：
  - **60 秒定时器** → 触发"洁癖"成就检测（在报告页停留超过 1 分钟）
  - **300 秒定时器** → 触发"圣人模式"成就检测（在报告页停留超过 5 分钟）
- 页面销毁时自动清理定时器

---

### 4. 历史记录页 (history)

**文件**: `src/pages/history/history.ux` (455 行)

**数据管理页面**，展示所有锻造历史并提供数据操作功能。

**UI 功能**：
- **记录列表**（可滚动）：每条记录显示日期、评级、次数和时长
- **单条删除**：每条记录右侧有"×"删除按钮
- **统计入口**：卡片式入口跳转至统计页面
- **底部操作栏**：
  - **"返回"** 按钮
  - **"清空"** 按钮（触发确认弹窗）
- **空状态**：无记录时显示"暂无记录"提示
- **清空确认弹窗**：模态对话框（"确认删除所有记录？"），含取消和删除按钮

**数据操作**：
- `loadHistory()` — 从 `system.storage` 加载历史
- `deleteRecord(index)` — 删除指定索引记录
- `clearHistory()` — 清空全部记录

---

### 5. 统计页 (stats)

**文件**: `src/pages/stats/stats.ux` (380 行)

**数据可视化页面**，提供周报和月报两个视角的统计分析。

**切换方式**：顶部 Tab 标签 + Swiper 组件联动（支持滑动切换和点击切换）

**周报视角**：
| 指标 | 说明 |
| :--- | :--- |
| 本周总次数 | 金色大字突出显示 |
| 本周次数 / 总时长 / 平均速度 | 三列小卡片 |
| 每日分布柱状图 | 周一至周日的锻造次数分布（7 个柱状条） |

**月报视角**：
| 指标 | 说明 |
| :--- | :--- |
| 本月总次数 | 橙红色大字突出显示 |
| 本月次数 / 总时长 / 平均速度 | 三列小卡片 |
| 趣味评语 | 根据月频率动态生成：`>30` = 大师级、`>20` = 热情高涨、`>10` = 稳定产出、`>0` = 学徒 |

**统计算法**：
- **周起止**：以周一为一周开始，统计当前周的所有记录
- **月起止**：以当月 1 日为起始，统计当月所有记录
- **平均 SPM**：`总次数 / 总时长(秒) × 60`

---

### 6. 设置页 (settings)

**文件**: `src/pages/settings/settings.ux` (368 行)

**用户偏好设置页面**，提供常规配置选项。

**配置项**：

| 设置项 | 选项 | 默认值 | 说明 |
| :--- | :--- | :--- | :--- |
| **佩戴方向** | 左手 / 右手 | 右手 | 切换后标记 `handChanged=true`，用于"双持狂战"成就判定 |
| **震动力度** | 关 / 弱 / 中 / 强 | 中 | 控制每次有效锻造的震动反馈强度 |
| **灵敏度设置** | — | — | 导航至灵敏度高级设置页（标注"仅限高级用户"） |

**震动时长映射**：

| 震动等级 | `strong` 模式 | 其它模式 |
| :--- | :--- | :--- |
| `weak` | 60ms | 40ms |
| `normal` | 100ms | 60ms |
| `off` | 不震动 | 不震动 |

**底部署名卡片**：展示应用名称、作者信息和社交账号。

---

### 7. 灵敏度设置页 (sensitivity)

**文件**: `src/pages/sensitivity/sensitivity.ux` (417 行)

**高级用户专属页面**，用于微调锻造检测算法的核心参数。

**进入时展示警告蒙层**：
> "高级设置包含核心算法参数，不当修改可能导致检测异常。"
>
> 用户必须点击**"我了解"**才能进入设置界面。

**可调参数**：

| 参数 | 默认值 | 调节范围 | 步长 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| **检测裕量** (minThreshold) | 0.20 g | — | ±0.05 | 均值穿越需超过的额外裕量，越小越灵敏 |
| **防抖时间** (debounceMs) | 140 ms | — | ±20 | 两次计数最小间隔，防止高频误触发 |

**操作**：
- 每个参数提供 `+` / `-` 按钮实时调节
- **"恢复默认值"** 按钮一键重置所有灵敏度参数

---

### 8. 成就殿堂页 (achievements)

**文件**: `src/pages/achievements/achievements.ux` (290 行)

**成就展示页面**，以列表形式展示所有 15 项成就及其解锁状态。

**UI 特色**：
- **标题**："成就殿堂"（金色 `#FFD700`）
- **进度条**：显示"已解锁 X / 15"，金色填充进度条
- **成就列表**（可滚动 `<list>` 组件）：
  - 已解锁：显示成就名称（对应稀有度颜色）、完整描述、右侧"V"标记
  - 未解锁：显示"???"（灰色）+ 解锁线索提示

**稀有度颜色体系**：

| 稀有度 | 等级值 | 颜色 | 色号 |
| :--- | :--- | :--- | :--- |
| 传说 | 5 | 橙红 | `#FF4500` |
| 史诗 | 4 | 紫色 | `#E040FB` |
| 稀有 | 3 | 金色 | `#FFD700` |
| 罕见 | 2 | 冷翠 | `#4ECDC4` |
| 普通 | 1 | 灰色 | `#A8A8A8` |

---

## 🧠 核心算法：HammerDetector

**文件位置**: `src/common/utils.js`，第 18~92 行

### 算法原理

IronForge 使用**均值穿越检测（Mean Crossing Detection）** 算法，这是一种经典的计步器原理变体，专门针对手腕往复运动进行了优化。

### 算法管线

```
三轴加速度 (x, y, z)          传感器原始数据（约 50Hz）
       ↓
合力幅值 (magnitude)          mag = sqrt(x² + y² + z²)
       ↓
滑动窗口 (25帧 ≈ 0.5秒)       维护最近 25 帧的幅值队列
       ↓
动态均值基线 (mean)            windowSum / windowSize
       ↓
动态阈值 (threshold)          mean + margin (裕量)
       ↓
上升沿检测                    prevMag ≤ threshold && mag > threshold
       ↓
防抖过滤                      timestamp - lastCount ≥ debounceMs
       ↓
有效冲程计数 ✓                 strokes++
```

### 关键设计细节

| 参数 | 默认值 | 说明 |
| :--- | :--- | :--- |
| `windowSize` | 25 帧 | 约 0.5 秒的数据（`game` 模式 ≈ 50Hz） |
| `margin` | 1.47 m/s² | 即 0.15g × 9.8，需要明显超过均值才计数 |
| `debounceMs` | 140 ms | 支持 SSS 级别速度（≈ 350+ SPM，即 ~171ms/次） |

### 为什么这个算法有效？

1. **动态基线**：滑动窗口均值自动适应用户的运动强度，静止时均值低（噪声不易超过），运动时均值高（跟随运动强度）
2. **上升沿唯一性**：每次往复运动只有一个上升穿越点，天然不会重复计数
3. **裕量防噪声**：额外的 `margin` 阈值避免均值附近的微小震颤被误计
4. **防抖保护**：最小间隔限制防止极高频震动被多次计数

### SPM 计算器

`SPMCalculator` 使用 **60 秒滑动窗口** 统计每分钟速度：
- 每次有效锻造记录时间戳
- 自动清理超过 60 秒的过期数据
- 防冷启动：时间跨度 < 3 秒且数据点 < 5 个时返回 0，避免初始 SPM 飙升

---

## 📊 评级系统

每次锻造结束后，系统从 **4 个维度** 独立评级，再通过**加权积分法**计算综合评级。

### 维度 1: 炉火纯度 — 持续时长 (权重 40%)

| 评级 | 描述 | 条件（分钟） |
| :--- | :--- | :--- |
| **SSS** | 永恒之焰 | ≥ 45 |
| **SS** | 不灭炉火 | ≥ 30 |
| **S** | 持久燃烧 | ≥ 20 |
| **A** | 稳定火候 | ≥ 10 |
| **B** | 初燃之焰 | ≥ 5 |
| **C** | 星星之火 | ≥ 2 |
| **D** | 一闪即灭 | < 2 |

### 维度 2: 锻打极速 — 峰值 SPM (权重 20%)

| 评级 | 描述 | 条件（峰值 SPM） |
| :--- | :--- | :--- |
| **SSS** | 音速锤击 | ≥ 350 |
| **SS** | 疾风迅雷 | ≥ 280 |
| **S** | 极速连击 | ≥ 220 |
| **A** | 快速节奏 | ≥ 160 |
| **B** | 中等手速 | ≥ 100 |
| **C** | 慢速敲打 | ≥ 60 |
| **D** | 蜗牛速度 | < 60 |

### 维度 3: 锤炼精度 — 节奏稳定性 (权重 10%)

稳定性通过 SPM 历史记录的**变异系数（标准差 / 均值 × 100%）** 衡量，值越小越稳定。

| 评级 | 描述 | 条件（标准差百分比） |
| :--- | :--- | :--- |
| **SSS** | 机械精度 | < 5% |
| **SS** | 极致稳定 | < 10% |
| **S** | 节奏大师 | < 15% |
| **A** | 节奏良好 | < 20% |
| **B** | 略有波动 | < 30% |
| **C** | 起伏不定 | < 50% |
| **D** | 断断续续 | ≥ 50% |

### 维度 4: 产出总量 — 总次数 (权重 30%)

| 评级 | 描述 | 条件（次） |
| :--- | :--- | :--- |
| **SSS** | 万锤百炼 | ≥ 5000 |
| **SS** | 千锤不息 | ≥ 3500 |
| **S** | 大量产出 | ≥ 2000 |
| **A** | 稳定产出 | ≥ 1000 |
| **B** | 小有成就 | ≥ 500 |
| **C** | 初步积累 | ≥ 100 |
| **D** | 寥寥数锤 | < 100 |

### 综合评级公式

```
总分 = 时长评级分 × 0.4 + 总量评级分 × 0.3 + 极速评级分 × 0.2 + 精度评级分 × 0.1
```

**评级分映射**：SSS=7, SS=6, S=5, A=4, B=3, C=2, D=1

| 综合评级 | 描述 | 总分要求 |
| :--- | :--- | :--- |
| **SSS** | 传世神器 | ≥ 6.5 |
| **SS** | 史诗杰作 | ≥ 5.5 |
| **S** | 大师之作 | ≥ 4.5 |
| **A** | 精良工艺 | ≥ 3.5 |
| **B** | 合格量产 | ≥ 2.5 |
| **C** | 粗制滥造 | ≥ 1.5 |
| **D** | 废料 | < 1.5 |

### 评级颜色体系

| 评级 | 颜色 | 色号 |
| :--- | :--- | :--- |
| SSS | 金色 | `#FFD700` |
| SS | 熔铁橙 | `#FF6B35` |
| S | 紫色 | `#E040FB` |
| A | 冷翠 | `#4ECDC4` |
| B | 浅翠 | `#95E1D3` |
| C | 灰色 | `#A8A8A8` |
| D | 深灰 | `#666666` |

---

## 🏆 成就系统

共 **15 项**成就，分布在 **5 个稀有度等级**中。成就判定分为两类：
- **即时判定**：锻造结束时在 `checkSessionAchievements()` 中自动检查
- **延时判定**：在报告页面通过定时器触发（`clean` 和 `sage`）

### 完整成就列表

| # | 成就名 | 稀有度 | 描述 | 解锁条件 |
| :--- | :--- | :--- | :--- | :--- |
| 1 | **初入铁匠铺** | 普通 | 点燃炉火，完成人生第一次锻造 | 累计完成 ≥1 次锻造记录 |
| 2 | **炉火升温** | 罕见 | 锻造节奏加快，铁炉温度攀升 | 本次峰值 SPM ≥ 180 |
| 3 | **雷霆万钧** | 史诗 | 锤击速度突破极限，铁砧上火花四溅 | 本次峰值 SPM ≥ 350 |
| 4 | **极速爆破** | 稀有 | 高强度短时爆发式锻造，瞬间释放全部力量 | 前 30 秒 SPM ≥ 120 **且** 总时长 < 60 秒 |
| 5 | **闪电出击** | 罕见 | 高效率完成一次快速锻造 | 总时长 < 120 秒（2 分钟） |
| 6 | **精准控制** | 史诗 | 张弛有度，精确掌控锻造节奏的起停 | 本次暂停次数 ≥ 3 次 |
| 7 | **晨练先锋** | 稀有 | 在周末清晨开始一天的锻造 | 在**周末** 09:00~11:00 时段锻造 |
| 8 | **夜间淬炼** | 稀有 | 万籁俱寂，唯有锤声回荡在深夜铁匠铺 | 在 **00:00~01:00** 时段锻造 |
| 9 | **铁匠节庆典** | 传说 | 在这个特别的日子里，以锤代笔书写传奇 | 在 **11 月 11 日** 当天锻造 |
| 10 | **以铁为伴** | 传说 | 浪漫佳节依然坚守铁匠铺，与铁砧为伴 | 在 **2 月 14 日** 当天锻造 |
| 11 | **精密锻压** | 史诗 | 锤击节奏如同精密机械般稳定而持久 | SPM 标准差 < 5% **且** 持续 ≥ 300 秒 |
| 12 | **双臂均衡** | 稀有 | 切换至非惯用手锻造，追求全面发展 | 在设置中切换佩戴方向后完成一次锻造 |
| 13 | **静心冥想** | 史诗 | 锻造后静坐沉思，领悟工匠之道的真谛 | 在报告页面停留超过 **5 分钟** (300 秒) |
| 14 | **工位整理** | 罕见 | 锻造完毕后认真审视成果，整理工位 | 在报告页面停留超过 **1 分钟** (60 秒) |
| 15 | **千锤百炼** | 传说 | 累计锻造达到惊人数量，真正的钢铁之臂 | 累计总锻造次数 ≥ **1,000,000** 次 |

### 成就统计

| 稀有度 | 数量 | 成就 |
| :--- | :--- | :--- |
| 传说 (5) | 3 个 | 铁匠节庆典、以铁为伴、千锤百炼 |
| 史诗 (4) | 4 个 | 雷霆万钧、精准控制、精密锻压、静心冥想 |
| 稀有 (3) | 4 个 | 极速爆破、晨练先锋、夜间淬炼、双臂均衡 |
| 罕见 (2) | 3 个 | 炉火升温、闪电出击、工位整理 |
| 普通 (1) | 1 个 | 初入铁匠铺 |

---

## 💾 数据持久化

所有数据通过 `@system.storage` API 进行本地持久化存储。

### 存储键值表

| 存储键 | 类型 | 说明 |
| :--- | :--- | :--- |
| `ironforge_history` | JSON 数组 | 历史锻造记录（最多保留 **50** 条，FIFO） |
| `ironforge_settings` | JSON 对象 | 用户设置（佩戴方向、震动强度、灵敏度参数） |
| `ach_<achievement_id>` | 字符串 `'1'` | 成就解锁状态，每个成就独立存储 |

### 默认设置值

```javascript
{
  hand: 'right',          // 佩戴方向
  vibration: 'normal',     // 震动强度
  sensitivity: {
    minThreshold: 0.20,    // 检测裕量 (g)
    debounceMs: 140,       // 防抖时间 (ms)
    dropRatio: 0.35,       // 下降比率
    adaptRatio: 0.55       // 自适应比率
  },
  handChanged: false       // 是否切换过佩戴方向
}
```

### 数据操作函数

| 函数 | 说明 |
| :--- | :--- |
| `saveSession(storage, session, callback)` | 保存会话到历史（队首插入，超过 50 条自动裁剪） |
| `loadHistory(storage, callback)` | 加载所有历史记录 |
| `deleteRecord(storage, index, callback)` | 删除指定索引的记录 |
| `clearHistory(storage, callback)` | 清空所有历史记录 |
| `loadSettings(storage, callback)` | 加载设置（缺失字段自动填充默认值） |
| `saveSettings(storage, settings, callback)` | 保存设置 |
| `loadAchievements(storage, callback)` | 加载所有成就解锁状态 |
| `saveAchievements(storage, achievements, callback)` | 保存成就解锁状态 |

---

## 🎨 设计系统

### 配色方案

IronForge 采用**复古工业风**暗色主题，专为 OLED 手表屏幕优化（纯黑背景最省电）。

| 用途 | 颜色名 | 色号 | 示例 |
| :--- | :--- | :--- | :--- |
| 主背景 | 深黑 | `#0A0A0A` / `#000000` | 所有页面背景 |
| 主色调 | 熔铁橙 / 橙红 | `#FF6B35` / `#FF4500` | 主按钮、高亮元素 |
| 强调色 | 金色 | `#FFD700` | SSS 评级、成就标题 |
| 辅助色 | 冷翠 | `#4ECDC4` | 装饰线、A 级评级 |
| 亮辅助色 | 冰蓝 | `#00E5FF` | 首页装饰线 |
| 文字主色 | 浅灰 | `#E0E0E0` / `#CCCCCC` | 正文文字 |
| 文字次色 | 中灰 | `#888888` | 次要信息 |
| 文字弱色 | 深灰 | `#555555` / `#444444` | 提示文字、描述 |
| 暗调色 | 深蓝黑 | `#1A1A2E` | 深色元素 |
| 卡片背景 | 极深灰 | `#111111` / `#0D0D0D` | 设置卡片、记录卡片 |
| 分隔线 | 暗灰 | `#222222` / `#333333` | 边框、分隔线 |
| 危险色 | 红色 | `#FF3333` | 删除按钮、确认弹窗 |

### 字体规范

| 用途 | 字号 | 字重 | 示例 |
| :--- | :--- | :--- | :--- |
| 首页标题 | 64px | bold | "铁锻" |
| 锻造主计数 | 72px+ | bold | 锻造次数 |
| 评级大字 | 36-40px | bold | "SSS" |
| 页面标题 | 22px | bold | "锻造报告" |
| 按钮文字 | 16-22px | bold | "开始锻造" |
| 正文信息 | 14-16px | normal | 数据显示 |
| 辅助文字 | 12-13px | normal | 描述、标签 |

### UI 组件风格

- **按钮**：圆角胶囊形（`border-radius: 50% of height`），主按钮橙红色、次要按钮深灰描边
- **卡片**：圆角 `12px`，深灰背景 `#111111`，1px 暗边框 `#1A1A1A`
- **进度条**：圆角 `3px`，深灰背景 `#1A1A1A`，金色填充

---

## 🚀 快速开始

### 环境准备

确保已安装以下工具：
- **Node.js** >= 8.10
- **npm**（随 Node.js 安装）
- **AIoT Toolkit CLI**（`aiot-toolkit`）

### 安装依赖

```bash
cd IronForge
npm install
```

### 开发模式运行

启动开发服务器（支持热重载）：

```bash
npm start
# 等效于: aiot start --watch
```

### 构建

生成构建产物：

```bash
npm run build
# 等效于: aiot build
```

### 发布

打包为发布版本：

```bash
npm run release
# 等效于: aiot release
```

### 代码检查

对 `.ux` 和 `.js` 文件执行 ESLint 检查并自动修复：

```bash
npm run lint
```

---

## � 使用指南

### 基本操作流程

```
┌──────────┐     ┌──────────┐     ┌──────────┐
│   首页    │ ──→ │  锻造页   │ ──→ │  报告页   │
│ (index)  │     │ (forge)  │     │ (report) │
│          │     │          │     │          │
│ 开始锻造  │     │ 自动开始  │     │ 综合评级  │
│ 查看记录  │     │ 实时数据  │     │ 详细分析  │
│ 查看成就  │     │ 后台计数  │     │ 成就解锁  │
│ 设置     │     │ 点击结束  │     │ 再来一次  │
└──────────┘     └──────────┘     └──────────┘
      │                                │
      ├──→ 历史记录 ──→ 统计       ←────┘
      ├──→ 成就殿堂
      └──→ 设置 ──→ 灵敏度设置
```

### 详细步骤

1. **佩戴**：将手表佩戴在惯用手上，确保佩戴紧致以获得最佳传感器读数
2. **设置（可选）**：在首页点击"设置"，配置佩戴方向和震动力度
3. **开始锻造**：在首页点击"开始锻造"，进入锻造页面
4. **自动响应**：无需额外操作，当手腕开始往复运动时，传感器即刻响应并开始计数
5. **息屏无忧**：即使屏幕熄灭，计数仍在后台持续进行
6. **结束锻造**：完成后点击底部"结束"按钮，系统自动保存并跳转到报告页
7. **查看报告**：在报告页查看本次综合评级和四维详细分析
8. **成就提示**：如果解锁了新成就，会依次弹出成就解锁通知
9. **继续或返回**：点击"再来一次"继续锻造，或点击"首页"返回

### 最佳实践

- **佩戴松紧**：过松会导致传感器读数不准，过紧影响舒适度
- **稳定节奏**：保持稳定的速度和幅度可以获得更高的"锤炼精度"评级
- **持久坚持**：时长是综合评级中权重最高的维度（40%），坚持更久能显著提升总评
- **灵敏度调节**：如果检测不灵敏或过于灵敏，可在设置 → 灵敏度中微调参数

---

## 📜 许可证与作者

**IronForge 淬火工坊** v1.0.0

- **作者**：弦
- **抖音**：LOVE54760
- **B站**：北极弦
- **包名**：`com.application.watch.demo`
